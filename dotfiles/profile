export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8
export PATH="$HOME/.cargo/bin:$HOME/System/scripts:$PATH"

which nvim > /dev/null 2>&1 && export EDITOR=nvim || export EDITOR=vim

# XDG Base Directory Conformance
export XDG_CONFIG_HOME="$HOME/.config"
export XDG_DATA_HOME="$HOME/.local/share"
export XDG_CACHE_HOME="$HOME/.cache"

# Start up an ssh-agent, but don't try to add any keys. There's no way to prompt from here.
# The shell or some other element of the environment should then prompt once it is capable of accepting input.
eval $(keychain --absolute --quiet --dir $XDG_CACHE_HOME/keychain --agents ssh --eval --systemd --noask)

# If we have a custom terminfo for $TERM, use it
maybe_terminfo="$XDG_CONFIG_HOME/terminfo/$(uname)/$TERM.ti"
[[ -f $maybe_terminfo ]] && export TERMINFO="$maybe_terminfo"

export TIGRC_USER="$XDG_CONFIG_HOME/tig/tigrc"
export VIMINIT="let \$MYVIMRC=\"$XDG_CONFIG_HOME/nvim/init.vim\" | source \$MYVIMRC"
# This will override nvim's search path, but does the same thing.
export HISTFILE="$XDG_DATA_HOME/$(basename $SHELL)/history"

export HOMEBREW_NO_AUTO_UPDATE=1

export RUST_SRC_PATH=$(rustc --print sysroot)/lib/rustlib/src/rust/src/

export WEECHAT_HOME="$XDG_CONFIG_HOME/weechat"

export GTK_BACKEND=wayland
export SDL_VIDEODRIVER=wayland
export QT_QPA_PLATFORM=wayland-egl
export QT_WAYLAND_SHELL_INTEGRATION=xdg-shell  # Default is -v6
export QUTE_SKIP_WAYLAND_CHECK=1

export XCURSOR_THEME=retrosmart-xcursors-black

stty -ixon # Keep Ctrl-s from freezing the terminal

if [ -n "$SSH_CONNECTION" ] && \
   [ -z "$TMUX" ] && \
   [ -n "$SSH_TTY" ] && \
   [ -z "$NO_TMUX" ] && \
   [ "$TERM" != "mobile" ];
then
    if [ -n "$TMUX_SESSION" ]; then
        session="$TMUX_SESSION"
    else
        session="$USER"
    fi

    which tmux >/dev/null 2>/dev/null
    if [ $? -eq 0 ]; then
        tmux new-session -A -s "$session" # Create or attach to existing session.
        exit
    fi
fi

# The "mobile" terminal type apparently exists, and is incredibly useless.
if [ "$TERM" = "mobile" ]; then
    export TERM=xterm-256color
    clear # Yay even more hacky. This fixes the visual corruption that happens right after mobile connect.
fi
